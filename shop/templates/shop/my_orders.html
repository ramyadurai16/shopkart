{% extends "shop/layouts/main.html" %}
{% load static %}

{% block title %} My Orders | ShopKart{% endblock %}

{% block content %}
<div class="container my-4">

  <h4 class="mb-4">ðŸ›’ My Orders</h4>

  {% for order in orders %}
  <div class="card mb-4 shadow-sm">

    <!-- ORDER HEADER -->
    <div class="card-header bg-light">
      <div class="row text-muted small">
        <div class="col-md-3">
          <strong>ORDER PLACED</strong><br>
          {{ order.created_at|date:"d M Y" }}
        </div>
        <div class="col-md-3">
          <strong>TOTAL</strong><br>
          â‚¹{{ order.total_price }}
        </div>
        <div class="col-md-3">
          <strong>PAYMENT</strong><br>
          {{ order.payment_mode }}
          {% if order.upi_app %}
            ({{ order.upi_app }})
          {% endif %}
        </div>
        <div class="col-md-3 text-end">
          <strong>STATUS</strong><br>
          
          {% if order.payment_status == "SUCCESS" %}
          <span class="badge bg-success">PAID</span>
          {% else %}
          <span class="badge bg-warning text-dark">PAYMENT PENDING</span>
          {% endif %}
          <br><br>

          {% if order.status == "PLACED" %}
            <span class="badge bg-secondary">PLACED</span>
          {% elif order.status == "SHIPPED" %}
            <small class="text-muted d-block">
              Shipped on {{ order.shipped_at|date:"d M Y" }}
            </small>
            <span class="badge bg-primary">SHIPPED</span>
          {% elif order.status == "OUT_FOR_DELIVERY" %}
            <span class="badge bg-warning text-dark">OUT FOR DELIVERY</span>
          {% elif order.status == "DELIVERED" %}
            <small class="text-muted d-block">
              Delivered on {{ order.delivered_at|date:"d M Y" }}
            </small>
          {% elif order.status == "CANCELLED" %}
            <span class="badge bg-danger">CANCELLED</span>
          {% endif %}
          
        </div>
      </div>
    </div>

    <!-- ORDER ITEMS -->
    <div class="card-body">
      {% for item in order.items.all %}
      <div class="row align-items-center mb-3">

        <div class="col-md-2">
          <img src="{{ item.product.product_image.url }}"
               class="img-fluid rounded"
               style="max-height:90px;">
        </div>

        <div class="col-md-6">
          <h6 class="mb-1">{{ item.product.name }}</h6>
          <small class="text-muted">Qty: {{ item.quantity }}</small>
        </div>

        <div class="col-md-4 text-end">
          <strong>â‚¹{{ item.price }}</strong>
        </div>

      </div>
      {% if not forloop.last %}
      <hr>
      {% endif %}
      {% endfor %}
    </div>

    <!-- ðŸ”½ ADD THIS PART HERE -->
    <div class="card-footer bg-white text-end">
      <a href="{% url 'order_details' order.id %}" 
         class="btn btn-outline-primary btn-sm">
         View Details
      </a>
       {% if order.status != "DELIVERED" and order.status != "CANCELLED" %}
         <a href="{% url 'cancel_order' order.id %}"
            class="btn btn-outline-danger btn-sm ms-2">
            Cancel Order
         </a>
       {% endif %}
    </div>

  </div>
  {% empty %}
  <p>No orders found.</p>
  {% endfor %}

</div>
{% endblock %}